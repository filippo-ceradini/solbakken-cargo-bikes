<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD Endpoint Test</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body.dark-mode {
            background-color: #222;
            color: #fff;
        }

        body.dark-mode input[type="text"],
        body.dark-mode input[type="email"],
        body.dark-mode input[type="password"],
        body.dark-mode textarea {
            background-color: #333;
            color: #fff;
        }
    </style>
</head>

<body class="dark-mode">
<div class="container mt-5">
    <div class="d-flex justify-content-start mb-3">
        <button id="darkModeBtn" class="btn btn-primary">Toggle Dark Mode</button>
    </div>
</div>

<div class="container mt-5">
    <h2>Login Test</h2>
    <!-- -->
    <h4>Login User</h4>
    <form id="loginUserForm">
        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" class="form-control" id="email-login" required>
        </div>
        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" class="form-control" id="password-login" required>
        </div>
        <div class="form-group">
            <button type="submit" id="loginButton" class="btn btn-primary">Login User</button>
            <button type="submit" id="logoutButton" class="btn btn-danger">Logout User</button>
        </div>
    </form>

    <h2>CRUD Endpoint Test</h2>

    <!-- Get Users -->
    <h4>Get Users</h4>
    <button id="getUsersBtn" class="btn btn-primary">Get Users</button>
    <ul id="usersList" class="mt-3"></ul>

    <!-- Create User -->
    <h4>Create User</h4>
    <form id="createUserForm">
        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" class="form-control" id="email" required>
        </div>
        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" class="form-control" id="password" required>
        </div>
        <div class="form-group">
            <button type="submit" class="btn btn-primary">Create User</button>
            <button type="submit" class="btn btn-danger">Subscribe</button>
        </div>
    </form>

    <!-- Send Email -->
    <h4>Send Email</h4>
    <form id="sendEmailForm">
        <div class="form-group">
            <label for="emailName">Name:</label>
            <input type="text" class="form-control" id="emailName" required>
        </div>
        <div class="form-group">
            <label for="emailAddress">Email:</label>
            <input type="email" class="form-control" id="emailAddress" required>
        </div>
        <div class="form-group">
            <label for="emailMessage">Message:</label>
            <textarea class="form-control" id="emailMessage" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Send Email</button>
    </form>

    <!-- Subscribe Email -->
    <h4>Subscribe Email</h4>
    <form id="subscribeEmailForm">
        <div class="form-group">
            <label for="subscribeEmailAddress">Email:</label>
            <input type="email" class="form-control" id="subscribeEmailAddress" required>
        </div>
        <div class="form-group">
            <label for="subscribeEmailPassword">Password:</label>
            <input type="password" class="form-control" id="subscribeEmailPassword" required>
        </div>
        <button type="submit" class="btn btn-primary">Subscribe</button>
    </form>

    <!-- Delete all users and user verification -->
    <h4>Delete all users</h4>
    <button type="button" id="delete-all-users">Delete'Em</button>

    <!-- Forgot Password -->
    <h4>Subscribe Email</h4>
    <form id="forgotPasswordForm">
        <div class="form-group">
            <label for="subscribeEmailAddress">Email:</label>
            <input type="email" class="form-control" id="forgotPasswordEmail" required>
        </div>
        <button type="submit" class="btn btn-primary">Send Password Email</button>
    </form>


    <!-- Update User -->
    <h4>Update User</h4>
    <form id="updateUserForm">
        <div class="form-group">
            <label for="update-user-userId">User ID:</label>
            <input type="text" class="form-control" id="update-user-userId" required>
        </div>
        <div class="form-group">
            <label for="newEmail">New Email:</label>
            <input type="email" class="form-control" id="newEmail" required>
        </div>
        <button type="submit" class="btn btn-primary">Update User</button>
    </form>

    <!-- Delete User -->
    <h4>Delete User</h4>
    <form id="deleteUserForm">
        <div class="form-group">
            <label for="deleteUserId">User ID:</label>
            <input type="text" class="form-control" id="deleteUserId" required>
        </div>
        <button type="submit" class="btn btn-danger">Delete User</button>
    </form>


    <!-- Create Item -->
    <h4>Create Item</h4>
    <form id="createItemForm">
        <div class="form-group">
            <label for="itemName">Item Name:</label>
            <input type="text" class="form-control" id="itemName" required>
        </div>
        <button type="submit" class="btn btn-primary">Create Item</button>
    </form>

    <!-- Get Items -->
    <h4>Get Items</h4>
    <button id="getItemsBtn" class="btn btn-primary">Get Items</button>
    <ul id="itemsList" class="mt-3"></ul>

    <!-- Update Item -->
    <h4>Update Item</h4>
    <form id="updateItemForm">
        <div class="form-group">
            <label for="update-item-itemId">Item ID:</label>
            <input type="text" class="form-control" id="update-item-itemId" required>
        </div>
        <div class="form-group">
            <label for="newName">New Name:</label>
            <input type="text" class="form-control" id="newName" required>
        </div>
        <button type="submit" class="btn btn-primary">Update Item</button>
    </form>

    <!-- Delete Item -->
    <h4>Delete Item</h4>
    <form id="deleteItemForm">
        <div class="form-group">
            <label for="deleteItemId">Item ID:</label>
            <input type="text" class="form-control" id="deleteItemId" required>
        </div>
        <button type="submit" class="btn btn-danger">Delete Item</button>
    </form>

    <!-- Create Booking -->
    <h4>Create Booking</h4>
    <form id="createBookingForm">
        <div class="form-group">
            <label for="startTime">Start Time:</label>
            <input type="datetime-local" class="form-control" id="startTime" required>
        </div>
        <div class="form-group">
            <label for="endTime">End Time:</label>
            <input type="datetime-local" class="form-control" id="endTime" required>
        </div>
        <div class="form-group">
            <label for="itemID">Item ID:</label>
            <input type="text" class="form-control" id="itemID" required>
        </div>
        <div class="form-group">
            <label for="userID">User ID:</label>
            <input type="text" class="form-control" id="userID" required>
        </div>
        <button type="submit" class="btn btn-primary">Create Booking</button>
    </form>

    <!-- Get Bookings -->
    <h4>Get Bookings</h4>
    <button id="getBookingsBtn" class="btn btn-primary">Get Bookings</button>
    <ul id="bookingsList" class="mt-3"></ul>

    <!-- Update Booking -->
    <h4>Update Booking</h4>
    <form id="updateBookingForm">
        <div class="form-group">
            <label for="bookingId">Booking ID:</label>
            <input type="text" class="form-control" id="bookingId" required>
        </div>
        <div class="form-group">
            <label for="newStartTime">New Start Time:</label>
            <input type="datetime-local" class="form-control" id="newStartTime" required>
        </div>
        <div class="form-group">
            <label for="newEndTime">New End Time:</label>
            <input type="datetime-local" class="form-control" id="newEndTime" required>
        </div>
        <div class="form-group">
            <label for="newItemID">New Item ID:</label>
            <input type="text" class="form-control" id="newItemID" required>
        </div>
        <div class="form-group">
            <label for="newUserID">New User ID:</label>
            <input type="text" class="form-control" id="newUserID" required>
        </div>
        <button type="submit" class="btn btn-primary">Update Booking</button>
    </form>

    <!-- Delete Booking -->
    <h4>Delete Booking</h4>
    <form id="deleteBookingForm">
        <div class="form-group">
            <label for="deleteBookingId">Booking ID:</label>
            <input type="text" class="form-control" id="deleteBookingId" required>
        </div>
        <button type="submit" class="btn btn-danger">Delete Booking</button>
    </form>

    <!-- Get Bookings By Date -->
    <h4>Get Bookings By Date</h4>
    <form id="getBookingsByDateForm">
        <div class="form-group">
            <label for="bookingDate">Booking Date:</label>
            <input type="date" class="form-control" id="bookingDate" required>
        </div>
        <button type="submit" class="btn btn-primary">Get Bookings By Date</button>
    </form>

    <!-- Get Bookings By User -->
    <h4>Get Bookings By User</h4>
    <form id="getBookingsByUserForm">
        <div class="form-group">
            <label for="bookingUserId">User ID:</label>
            <input type="text" class="form-control" id="bookingUserId" required>
        </div>
        <button type="submit" class="btn btn-primary">Get Bookings By User</button>
    </form>
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.socket.io/4.1.3/socket.io.min.js"></script>
<script>
    const socket = io(process.env.SERVER_URL);

    // Toggle Dark Mode
    $("#darkModeBtn").click(function () {
        $("body").toggleClass("dark-mode");
    });

    // Login
    document.getElementById('loginButton').onclick = function () {
        var email = document.getElementById('email-login').value;
        var password = document.getElementById('password-login').value;

        socket.emit('login', {email: email, password: password});
    }
    //Logout
    document.getElementById('logoutButton').onclick = function () {
        socket.emit('logout');
    }
    //Log Messages
    socket.on('log-messages', function (data) {
        console.log(data);
        if (data.message) {
            alert(data.message);
        }
        // Handle the response messages here and update the UI accordingly
    });

    // Create User √
    $("#createUserForm").submit(function (e) {
        e.preventDefault();
        const email = $("#email").val();
        const password = $("#password").val();
        socket.emit("createUser", {email, password});
    });

    // Get Users √
    $("#getUsersBtn").click(function () {
        socket.emit("getUsers");
    });
    socket.on("user-messages", function (data) {
        if (data.status === 200) {
            if (data.message === "User created successfully") {
                alert(data.message);
            } else if (data.message === "Retrieved users successfully") {
                const users = data.users;
                const usersList = $("#usersList");
                usersList.empty();
                users.forEach(function (user) {
                    const listItem = `<li>${user.email} ${user._id}</li>`;

                    usersList.append(listItem);
                });
            }
        } else {
            console.log("Error:", data.message);
        }
    });

    // Update User √
    $("#updateUserForm").submit(function (e) {
        e.preventDefault();
        const userId = $("#update-user-userId").val();
        const newEmail = $("#newEmail").val();
        alert(userId + newEmail)
        socket.emit("updateUser", {id: userId, email: newEmail});
    });

    // Delete User √
    $("#deleteUserForm").submit(function (e) {
        e.preventDefault();
        const deleteUserId = $("#deleteUserId").val();
        socket.emit("deleteUser", {id: deleteUserId});
    });

    // Create Item √
    $("#createItemForm").submit(function (e) {
        e.preventDefault();
        const itemName = $("#itemName").val();
        socket.emit("createItem", {name: itemName});
    });

    // Get Items √
    $("#getItemsBtn").click(function () {
        socket.emit("getItems");
    });
    socket.on("item-messages", function (data) {
        if (data.status === 200) {
            if (data.message === "Item created successfully") {
                alert(data.message);
            } else if (data.message === "Retrieved items successfully") {
                const items = data.items;
                const itemsList = $("#itemsList");
                itemsList.empty();
                items.forEach(function (item) {
                    const listItem = `<li>${item.name} ${item._id}</li>`;
                    itemsList.append(listItem);
                });
            }
        } else {
            console.log("Error:", data.message);
        }
    });

    // Update Item √
    $("#updateItemForm").submit(function (e) {
        e.preventDefault();
        const itemId = $("#update-item-itemId").val();
        const newName = $("#newName").val();
        socket.emit("updateItem", {id: itemId, name: newName});
    });

    // Delete Item √
    $("#deleteItemForm").submit(function (e) {
        e.preventDefault();
        const deleteItemId = $("#deleteItemId").val();
        socket.emit("deleteItem", {id: deleteItemId});
    });

    // Create Booking √
    $("#createBookingForm").submit(function (e) {
        e.preventDefault();
        const startTime = $("#startTime").val();
        const endTime = $("#endTime").val();
        const itemID = $("#itemID").val();
        const userID = $("#userID").val();
        socket.emit("createBooking", {startTime, endTime, itemID, userID});
    });

    // Get Bookings  TODO: get booking IDs
    $("#getBookingsBtn").click(function () {
        socket.emit("getBookings");
    });
    socket.on("booking-messages", function (data) {
        if (data.status === 200) {
            if (data.message === "Booking created successfully") {
                alert(data.message);
            } else if (data.message === "Retrieved bookings successfully") {
                const bookings = data.bookings;
                const bookingsList = $("#bookingsList");
                bookingsList.empty();
                bookings.forEach(function (booking) {
                    const listItem = `<li>Booking ID: ${booking._id} - Start Time: ${booking.startTime} - End Time: ${booking.endTime} - Item ID: ${booking.itemID.toString()} - User ID: ${booking.userID}</li>`;
                    bookingsList.append(listItem);
                });
            }
        } else {
            console.log("Error:", data.message);
        }
    });

    // Subscribe Email
    $("#subscribeEmailForm").submit(function (e) {
        e.preventDefault();
        const email = $("#subscribeEmailAddress").val();
        const password = $("#subscribeEmailPassword").val();
        socket.emit("subscribe-email", {email, password});
    });
    socket.on("subscribe-messages", function (data) {
        if (data.message) {
            alert(data.message);
        } else {
            console.log("Error:", data.message);
            alert("Error: " + data.message);
        }
    });

    // Delete All Users
    $("#delete-all-users").click(function (e) {
        e.preventDefault();
        socket.emit("delete-all-users", {delete: true});
    });

    // Forgot Password
    $("#forgotPasswordForm").submit(function (e) {
        e.preventDefault();
        const email = $("#forgotPasswordEmail").val();
        socket.emit("forgot-password", {email});
    });
    // Listen and alert user messages
    socket.on("user-messages", function (data) {
        if (data.message) {
            alert(data.message);
        } else {
            console.log("Error:", data.message);
            alert("Error: " + data.message);
        }
    });

    // Update Booking √
    $("#updateBookingForm").submit(function (e) {
        e.preventDefault();
        const bookingId = $("#bookingId").val();
        const newStartTime = $("#newStartTime").val();
        const newEndTime = $("#newEndTime").val();
        const newItemID = $("#newItemID").val();
        const newUserID = $("#newUserID").val();
        socket.emit("updateBooking", {
            id: bookingId,
            startTime: newStartTime,
            endTime: newEndTime,
            itemID: newItemID,
            userID: newUserID
        });
    });

    // Delete Booking √
    $("#deleteBookingForm").submit(function (e) {
        e.preventDefault();
        const deleteBookingId = $("#deleteBookingId").val();
        socket.emit("deleteBooking", {id: deleteBookingId});
    });

    // Get Bookings By Date
    $("#getBookingsByDateForm").submit(function (e) {
        e.preventDefault();
        const bookingDate = $("#bookingDate").val();
        socket.emit("getBookingsByDate", bookingDate);
    });

    // Send Email
    $("#sendEmailForm").submit(function (e) {
        e.preventDefault();
        const name = $("#emailName").val();
        const email = $("#emailAddress").val();
        const message = $("#emailMessage").val();
        socket.emit("contact-email", {name, email, message});
    });
    socket.on("email-response", function (data) {
        if (data.status === 200) {
            alert(data.message);
        } else {
            console.log("Error:", data.message);
            alert("Error: " + data.message);
        }
    });

    // Get Bookings By User
    $("#getBookingsByUserForm").submit(function (e) {
        e.preventDefault();
        const bookingUserId = $("#bookingUserId").val();
        socket.emit("getBookingsByUser", bookingUserId);
    });
    socket.on("booking-messages", function (data) {
        if (data.status === 200) {
            if (data.message === "Booking created successfully") {
                alert(data.message);
            } else if (data.message === "Retrieved bookings successfully") {
                const bookings = data.bookings;
                const bookingsList = $("#bookingsList");
                bookingsList.empty();
                bookings.forEach(function (booking) {
                    const listItem = `<li>Booking ID: ${booking._id} - Start Time: ${booking.startTime} - End Time: ${booking.endTime} - Item ID: ${booking.itemID} - User ID: ${booking.userID._id}</li>`;
                    bookingsList.append(listItem);
                });
                alert("Bookings retrieved successfully");
            } else if (data.message === "Retrieved bookings for the specified date successfully") {
                const bookings = data.bookings;
                const bookingsList = $("#bookingsList");
                bookingsList.empty();
                bookings.forEach(function (booking) {
                    const listItem = `<li>Booking ID: ${booking._id} - Start Time: ${booking.startTime} - End Time: ${booking.endTime} - Item ID: ${booking.itemID} - User ID: ${booking.userID._id}</li>`;
                    bookingsList.append(listItem);
                });
                alert("Bookings retrieved for the specified date successfully");
            } else if (data.message === "Retrieved bookings for the specified user successfully") {
                const bookings = data.bookings;
                const bookingsList = $("#bookingsList");
                bookingsList.empty();
                bookings.forEach(function (booking) {
                    const listItem = `<li>Booking ID: ${booking._id} - Start Time: ${booking.startTime} - End Time: ${booking.endTime} - Item ID: ${booking.itemID} - User ID: ${booking.userID._id}</li>`;
                    bookingsList.append(listItem);
                });
                alert("Bookings retrieved for the specified user successfully");
            }
        } else {
            console.log("Error:", data.message);
            alert("Error: " + data.message);
        }
    });

    // socket listen to unauthorized access
    socket.on("unauthorized", function (data) {
        console.log("Unauthorized access:", data.message);
        alert("Unauthorized access: " + data.message);
    });

</script>

</body>

</html>
