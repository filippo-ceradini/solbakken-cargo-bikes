<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD Endpoint Test</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body.dark-mode {
            background-color: #222;
            color: #fff;
        }

        body.dark-mode input[type="text"],
        body.dark-mode input[type="email"],
        body.dark-mode input[type="password"],
        body.dark-mode textarea {
            background-color: #333;
            color: #fff;
        }
    </style>

</head>

<body class="dark-mode">
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>

<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

<script src="https://use.fontawesome.com/ee1c3da296.js"></script>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">Navbar</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
                <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">Link</a>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Dropdown
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <a class="dropdown-item" href="#">Action</a>
                    <a class="dropdown-item" href="#">Another action</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="#">Something else here</a>
                </div>
            </li>
            <li class="nav-item">
                <a class="nav-link disabled" href="#">Disabled</a>
            </li>
        </ul>
        <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form>
    </div>
</nav>


<div class="container mt-5">
    <div class="d-flex justify-content-start mb-3">
        <button id="darkModeBtn" class="btn btn-primary">Toggle Dark Mode</button>
    </div>
</div>

<div class="container mt-5">
    <h2>Login Test</h2>
    <!-- -->
    <h4>Login User</h4>
    <form id="loginUserForm">
        <div class="form-group">
            <label for="email-login">Email:</label>
            <input type="email" class="form-control" id="email-login" required>
        </div>
        <div class="form-group">
            <label for="password-login">Password:</label>
            <input type="password" class="form-control" id="password-login" required>
        </div>
        <div class="form-group">
            <button type="submit" id="loginButton" class="btn btn-primary">Login User</button>
            <button type="submit" id="logoutButton" class="btn btn-danger">Logout User</button>
        </div>
    </form>

    <h2>CRUD Endpoint Test</h2>

    <!-- Get Users -->
    <h4>Get Users</h4>
    <button id="getUsersBtn" class="btn btn-primary">Get Users</button>
    <ul id="usersList" class="mt-3"></ul>

    <!-- Create User -->
    <h4>Create User</h4>
    <form id="createUserForm">
        <div class="form-group">
            <label for="usernameSignup">Username:</label>
            <input type="text" class="form-control" id="usernameSignup" required>
        </div>
        <div class="form-group">
            <label for="emailNewUser">Email:</label>
            <input type="email" class="form-control" id="emailNewUser" required>
        </div>
        <div class="form-group">
            <label for="passwordNewUser">Password:</label>
            <input type="password" class="form-control" id="passwordNewUser" required>
        </div>
        <div class="form-group">
            <button type="submit" class="btn btn-primary">Create User</button>
            <button type="submit" class="btn btn-danger">Subscribe</button>
        </div>
    </form>

    <!-- Send Email -->
    <h4>Send Email</h4>
    <form id="sendEmailForm">
        <div class="form-group">
            <label for="emailName">Name:</label>
            <input type="text" class="form-control" id="emailName" required>
        </div>
        <div class="form-group">
            <label for="emailAddress">Email:</label>
            <input type="email" class="form-control" id="emailAddress" required>
        </div>
        <div class="form-group">
            <label for="emailMessage">Message:</label>
            <textarea class="form-control" id="emailMessage" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Send Email</button>
    </form>

    <!-- Subscribe Email -->
    <h4>Subscribe Email</h4>
    <form id="subscribeEmailForm">
        <div class="form-group">
            <label for="subscribeEmailAddress">Email:</label>
            <input type="email" class="form-control" id="subscribeEmailAddress" required>
        </div>
        <div class="form-group">
            <label for="subscribeEmailPassword">Password:</label>
            <input type="password" class="form-control" id="subscribeEmailPassword" required>
        </div>
        <button type="submit" class="btn btn-primary">Subscribe</button>
    </form>

    <!-- Upload Photo -->
    <div class="container">
        <div class="row justify-content-center mt-5">
            <div class="col-md-6">
                <h2 class="text-center">Upload Photo</h2>
                <form id="uploadForm" enctype="multipart/form-data">
                    <div class="form-group">
                        <label>Select Photo:</label>
                        <input accept="image/*" capture="camera" class="form-control" id="photo" name="photo" type="file">
                    </div>
                    <button class="btn btn-primary" id="uploadButton" type="submit">Upload</button>

                </form>
                <div class="progress mt-3">
                    <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <button class="btn btn-primary" onclick="socketTest()" id="testButton">Socket Test</button>
            </div>
        </div>
    </div>

    <!-- Delete all users and user verification -->
    <h4>Delete all users</h4>
    <button type="button" id="delete-all-users">Delete'Em</button>

    <!-- Forgot Password -->
    <h4>Subscribe Email</h4>
    <form id="forgotPasswordForm">
        <div class="form-group">
            <label for="subscribeEmailAddress">Email:</label>
            <input type="email" class="form-control" id="forgotPasswordEmail" required>
        </div>
        <button type="submit" class="btn btn-primary">Send Password Email</button>
    </form>


    <!-- Update User -->
    <h4>Update User</h4>
    <form id="updateUserForm">
        <div class="form-group">
            <label for="update-user-userId">User ID:</label>
            <input type="text" class="form-control" id="update-user-userId" required>
        </div>
        <div class="form-group">
            <label for="newEmail">New Email:</label>
            <input type="email" class="form-control" id="newEmail" required>
        </div>
        <button type="submit" class="btn btn-primary">Update User</button>
    </form>

    <!-- Delete User -->
    <h4>Delete User</h4>
    <form id="deleteUserForm">
        <div class="form-group">
            <label for="deleteUserId">User ID:</label>
            <input type="text" class="form-control" id="deleteUserId" required>
        </div>
        <button type="submit" class="btn btn-danger">Delete User</button>
    </form>


    <!-- Create Item -->
    <h4>Create Item</h4>
    <form id="createItemForm">
        <div class="form-group">
            <label for="itemName">Item Name:</label>
            <input type="text" class="form-control" id="itemName" required>
        </div>
        <button type="submit" class="btn btn-primary">Create Item</button>
    </form>

    <!-- Get Items -->
    <h4>Get Items</h4>
    <button id="getItemsBtn" class="btn btn-primary">Get Items</button>
    <ul id="itemsList" class="mt-3"></ul>

    <!-- Update Item -->
    <h4>Update Item</h4>
    <form id="updateItemForm">
        <div class="form-group">
            <label for="update-item-itemId">Item ID:</label>
            <input type="text" class="form-control" id="update-item-itemId" required>
        </div>
        <div class="form-group">
            <label for="newName">New Name:</label>
            <input type="text" class="form-control" id="newName" required>
        </div>
        <button type="submit" class="btn btn-primary">Update Item</button>
    </form>

    <!-- Delete Item -->
    <h4>Delete Item</h4>
    <form id="deleteItemForm">
        <div class="form-group">
            <label for="deleteItemId">Item ID:</label>
            <input type="text" class="form-control" id="deleteItemId" required>
        </div>
        <button type="submit" class="btn btn-danger">Delete Item</button>
    </form>

    <!-- Create Booking -->
    <h4>Create Booking</h4>
    <form id="createBookingForm">
        <div class="form-group">
            <label for="startTime">Start Time:</label>
            <input type="datetime-local" class="form-control" id="startTime" required>
        </div>
        <div class="form-group">
            <label for="endTime">End Time:</label>
            <input type="datetime-local" class="form-control" id="endTime" required>
        </div>
        <div class="form-group">
            <label for="itemID">Item ID:</label>
            <input type="text" class="form-control" id="itemID" required>
        </div>
        <div class="form-group">
            <label for="userID">User ID:</label>
            <input type="text" class="form-control" id="userID" required>
        </div>
        <button type="submit" class="btn btn-primary">Create Booking</button>
    </form>

    <!-- Get Bookings -->
    <h4>Get Bookings</h4>
    <button id="getBookingsBtn" class="btn btn-primary">Get Bookings</button>
    <ul id="bookingsList" class="mt-3"></ul>

    <!-- Update Booking -->
    <h4>Update Booking</h4>
    <form id="updateBookingForm">
        <div class="form-group">
            <label for="bookingId">Booking ID:</label>
            <input type="text" class="form-control" id="bookingId" required>
        </div>
        <div class="form-group">
            <label for="newStartTime">New Start Time:</label>
            <input type="datetime-local" class="form-control" id="newStartTime" required>
        </div>
        <div class="form-group">
            <label for="newEndTime">New End Time:</label>
            <input type="datetime-local" class="form-control" id="newEndTime" required>
        </div>
        <div class="form-group">
            <label for="newItemID">New Item ID:</label>
            <input type="text" class="form-control" id="newItemID" required>
        </div>
        <div class="form-group">
            <label for="newUserID">New User ID:</label>
            <input type="text" class="form-control" id="newUserID" required>
        </div>
        <button type="submit" class="btn btn-primary">Update Booking</button>
    </form>

    <!-- Delete Booking -->
    <h4>Delete Booking</h4>
    <form id="deleteBookingForm">
        <div class="form-group">
            <label for="deleteBookingId">Booking ID:</label>
            <input type="text" class="form-control" id="deleteBookingId" required>
        </div>
        <button type="submit" class="btn btn-danger">Delete Booking</button>
    </form>

    <!-- Get Bookings By Date -->
    <h4>Get Bookings By Date</h4>
    <form id="getBookingsByDateForm">
        <div class="form-group">
            <label for="bookingDate">Booking Date:</label>
            <input type="date" class="form-control" id="bookingDate" required>
        </div>
        <button type="submit" class="btn btn-primary">Get Bookings By Date</button>
    </form>

    <!-- Get Bookings By User -->
    <h4>Get Bookings By User</h4>
    <form id="getBookingsByUserForm">
        <div class="form-group">
            <label for="bookingUserId">User ID:</label>
            <input type="text" class="form-control" id="bookingUserId" required>
        </div>
        <button type="submit" class="btn btn-primary">Get Bookings By User</button>
    </form>
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.socket.io/4.1.3/socket.io.min.js"></script>
<script>
    const socket = io('http://localhost:8080');

    // Toggle Dark Mode
    $("#darkModeBtn").click(function () {
        $("body").toggleClass("dark-mode");
    });



    // Login
    document.getElementById('loginButton').onclick = async function () {
        console.log("login")
        const response = await fetch('http://localhost:8080/login', {

            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            credentials: 'include', // This is important for sending and receiving cookies
            body: JSON.stringify({
                email: 'murray88mph@gmail.com',
                password: 'password',
            }),
        });

        const data = await response.json();
        console.log(data); // Log the server's response to the console
    }
    //Logout
    document.getElementById('logoutButton').onclick = function () {
        socket.emit('logout');
    }
    //Log Messages
    socket.on('log-messages', function (data) {
        console.log(data);
        if (data.message) {
            alert(data.message);
        }
        // Handle the response messages here and update the UI accordingly
    });

    // Create User √
    $("#createUserForm").submit(function (e) {
        e.preventDefault();
        const name = $("#usernameSignup").val();
        const email = $("#emailNewUser").val();
        const password = $("#passwordNewUser").val();
        socket.emit("createUser", {name , email, password});
    });

    // Get Users √
    $("#getUsersBtn").click(function () {
        socket.emit("getUsers");
    });
    socket.on("user-messages", function (data) {
        if (data.status === 200) {
            if (data.message === "User created successfully") {
                alert(data.message);
            } else if (data.message === "Retrieved users successfully") {
                const users = data.users;
                const usersList = $("#usersList");
                usersList.empty();
                users.forEach(function (user) {
                    const listItem = `<li>${user.email} ${user._id}</li>`;

                    usersList.append(listItem);
                });
            }
        } else {
            console.log("Error:", data.message);
        }
    });

    // Update User √
    $("#updateUserForm").submit(function (e) {
        e.preventDefault();
        const userId = $("#update-user-userId").val();
        const newEmail = $("#newEmail").val();
        alert(userId + newEmail)
        socket.emit("updateUser", {id: userId, email: newEmail});
    });

    // Delete User √
    $("#deleteUserForm").submit(function (e) {
        e.preventDefault();
        const deleteUserId = $("#deleteUserId").val();
        socket.emit("deleteUser", {id: deleteUserId});
    });

    $("#uploadForm").on('submit', e => {
        e.preventDefault();
        const formData = new FormData();
        const photoFile = $('#photo')[0].files[0];
        if (photoFile) {
            formData.append('photo', photoFile);
            $.ajax({
                url: '/upload',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                xhr: function() {
                    var xhr = new window.XMLHttpRequest();
                    xhr.upload.addEventListener("progress", function(evt) {
                        if (evt.lengthComputable) {
                            var percentComplete = evt.loaded / evt.total;
                            percentComplete = parseInt(percentComplete * 100);
                            $('.progress-bar').width(percentComplete + '%').attr('aria-valuenow', percentComplete);
                            if (percentComplete === 100) {
                                $('.progress-bar').html('Upload completed');
                            }
                        }
                    }, false);
                    return xhr;
                },
                success: function(data) {
                    alert(data.message);
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    alert(`An error occurred: ${jqXHR.responseJSON.message}`);
                }
            });


        } else {
            alert('Please select a photo!');
        }
    });

    function socketTest() {
        socket.emit('test', {message: 'test'})
    }

    // Create Item √
    $("#createItemForm").submit(function (e) {
        e.preventDefault();
        const itemName = $("#itemName").val();
        socket.emit("createItem", {name: itemName});
    });

    // Get Items √
    $("#getItemsBtn").click(function () {
        socket.emit("getItems");
    });
    socket.on("item-messages", function (data) {
        if (data.status === 200) {
            if (data.message === "Item created successfully") {
                alert(data.message);
            } else if (data.message === "Retrieved items successfully") {
                const items = data.items;
                const itemsList = $("#itemsList");
                itemsList.empty();
                items.forEach(function (item) {
                    const listItem = `<li>${item.name} ${item._id}</li>`;
                    itemsList.append(listItem);
                });
            }
        } else {
            console.log("Error:", data.message);
        }
    });

    // Update Item √
    $("#updateItemForm").submit(function (e) {
        e.preventDefault();
        const itemId = $("#update-item-itemId").val();
        const newName = $("#newName").val();
        socket.emit("updateItem", {id: itemId, name: newName});
    });

    // Delete Item √
    $("#deleteItemForm").submit(function (e) {
        e.preventDefault();
        const deleteItemId = $("#deleteItemId").val();
        socket.emit("deleteItem", {id: deleteItemId});
    });

    // Create Booking √
    $("#createBookingForm").submit(function (e) {
        e.preventDefault();
        const startTime = $("#startTime").val();
        const endTime = $("#endTime").val();
        const itemID = $("#itemID").val();
        const userID = $("#userID").val();
        socket.emit("createBooking", {startTime, endTime, itemID, userID});
    });

    // Get Bookings  TODO: get booking IDs
    $("#getBookingsBtn").click(function () {
        socket.emit("getBookings");
    });
    socket.on("booking-messages", function (data) {
        if (data.status === 200) {
            if (data.message === "Booking created successfully") {
                alert(data.message);
            } else if (data.message === "Retrieved bookings successfully") {
                const bookings = data.bookings;
                const bookingsList = $("#bookingsList");
                bookingsList.empty();
                bookings.forEach(function (booking) {
                    const listItem = `<li>Booking ID: ${booking._id} - Start Time: ${booking.startTime} - End Time: ${booking.endTime} - Item ID: ${booking.itemID.toString()} - User ID: ${booking.userID}</li>`;
                    bookingsList.append(listItem);
                });
            }
        } else {
            console.log("Error:", data.message);
        }
    });

    // Subscribe Email
    $("#subscribeEmailForm").submit(function (e) {
        e.preventDefault();
        const email = $("#subscribeEmailAddress").val();
        const password = $("#subscribeEmailPassword").val();
        socket.emit("subscribe-email", {email, password});
    });
    socket.on("subscribe-messages", function (data) {
        if (data.message) {
            alert(data.message);
        } else {
            console.log("Error:", data.message);
            alert("Error: " + data.message);
        }
    });



    // Delete All Users
    $("#delete-all-users").click(function (e) {
        e.preventDefault();
        socket.emit("delete-all-users", {delete: true});
    });

    // Forgot Password
    $("#forgotPasswordForm").submit(function (e) {
        e.preventDefault();
        const email = $("#forgotPasswordEmail").val();
        socket.emit("forgot-password", {email});
    });
    // Listen and alert user messages
    socket.on("user-messages", function (data) {
        if (data.message) {
            alert(data.message);
        } else {
            console.log("Error:", data.message);
            alert("Error: " + data.message);
        }
    });

    // Update Booking √
    $("#updateBookingForm").submit(function (e) {
        e.preventDefault();
        const bookingId = $("#bookingId").val();
        const newStartTime = $("#newStartTime").val();
        const newEndTime = $("#newEndTime").val();
        const newItemID = $("#newItemID").val();
        const newUserID = $("#newUserID").val();
        socket.emit("updateBooking", {
            id: bookingId,
            startTime: newStartTime,
            endTime: newEndTime,
            itemID: newItemID,
            userID: newUserID
        });
    });

    // Delete Booking √
    $("#deleteBookingForm").submit(function (e) {
        e.preventDefault();
        const deleteBookingId = $("#deleteBookingId").val();
        socket.emit("deleteBooking", {id: deleteBookingId});
    });

    // Get Bookings By Date
    $("#getBookingsByDateForm").submit(function (e) {
        e.preventDefault();
        const bookingDate = $("#bookingDate").val();
        socket.emit("getBookingsByDate", bookingDate);
    });

    // Send Email
    $("#sendEmailForm").submit(function (e) {
        e.preventDefault();
        const name = $("#emailName").val();
        const email = $("#emailAddress").val();
        const message = $("#emailMessage").val();
        socket.emit("contact-email", {name, email, message});
    });
    socket.on("email-response", function (data) {
        if (data.status === 200) {
            alert(data.message);
        } else {
            console.log("Error:", data.message);
            alert("Error: " + data.message);
        }
    });

    // Get Bookings By User
    $("#getBookingsByUserForm").submit(function (e) {
        e.preventDefault();
        const bookingUserId = $("#bookingUserId").val();
        socket.emit("getBookingsByUser", bookingUserId);
    });
    socket.on("booking-messages", function (data) {
        if (data.status === 200) {
            if (data.message === "Booking created successfully") {
                alert(data.message);
            } else if (data.message === "Retrieved bookings successfully") {
                const bookings = data.bookings;
                const bookingsList = $("#bookingsList");
                bookingsList.empty();
                bookings.forEach(function (booking) {
                    const listItem = `<li>Booking ID: ${booking._id} - Start Time: ${booking.startTime} - End Time: ${booking.endTime} - Item ID: ${booking.itemID} - User ID: ${booking.userID._id}</li>`;
                    bookingsList.append(listItem);
                });
                alert("Bookings retrieved successfully");
            } else if (data.message === "Retrieved bookings for the specified date successfully") {
                const bookings = data.bookings;
                const bookingsList = $("#bookingsList");
                bookingsList.empty();
                bookings.forEach(function (booking) {
                    const listItem = `<li>Booking ID: ${booking._id} - Start Time: ${booking.startTime} - End Time: ${booking.endTime} - Item ID: ${booking.itemID} - User ID: ${booking.userID._id}</li>`;
                    bookingsList.append(listItem);
                });
                alert("Bookings retrieved for the specified date successfully");
            } else if (data.message === "Retrieved bookings for the specified user successfully") {
                const bookings = data.bookings;
                const bookingsList = $("#bookingsList");
                bookingsList.empty();
                bookings.forEach(function (booking) {
                    const listItem = `<li>Booking ID: ${booking._id} - Start Time: ${booking.startTime} - End Time: ${booking.endTime} - Item ID: ${booking.itemID} - User ID: ${booking.userID._id}</li>`;
                    bookingsList.append(listItem);
                });
                alert("Bookings retrieved for the specified user successfully");
            }
        } else {
            console.log("Error:", data.message);
            alert("Error: " + data.message);
        }
    });

    // socket listen to unauthorized access
    socket.on("unauthorized", function (data) {
        console.log("Unauthorized access:", data.message);
        alert("Unauthorized access: " + data.message);
    });

</script>

</body>

</html>
